<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Controle Financeiro Unificado</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f5f5;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .tabs {
            display: flex;
            background: #2c3e50;
            border-radius: 8px 8px 0 0;
            overflow-x: auto;
        }
        
        .tab {
            padding: 15px 25px;
            color: white;
            cursor: pointer;
            border: none;
            background: transparent;
            font-size: 14px;
            white-space: nowrap;
            transition: background 0.3s;
        }
        
        .tab:hover {
            background: rgba(255,255,255,0.1);
        }
        
        .tab.active {
            background: white;
            color: #2c3e50;
        }
        
        .tab-content {
            display: none;
            padding: 30px;
        }
        
        .tab-content.active {
            display: block;
        }
        
        h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 24px;
        }
        
        .cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #3498db;
        }
        
        .card.positive {
            border-left-color: #27ae60;
        }
        
        .card.negative {
            border-left-color: #e74c3c;
        }
        
        .card-title {
            font-size: 14px;
            color: #7f8c8d;
            margin-bottom: 8px;
        }
        
        .card-value {
            font-size: 28px;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            color: #2c3e50;
            font-weight: 500;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        
        textarea {
            resize: vertical;
            min-height: 60px;
        }
        
        .btn {
            background: #3498db;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: background 0.3s;
        }
        
        .btn:hover {
            background: #2980b9;
        }
        
        .btn-success {
            background: #27ae60;
        }
        
        .btn-success:hover {
            background: #229954;
        }
        
        .btn-danger {
            background: #e74c3c;
        }
        
        .btn-danger:hover {
            background: #c0392b;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ecf0f1;
        }
        
        th {
            background: #f8f9fa;
            color: #2c3e50;
            font-weight: 600;
        }
        
        tr:hover {
            background: #f8f9fa;
        }
        
        .filters {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .chart-container {
            margin: 30px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        
        .action-btn {
            padding: 6px 12px;
            font-size: 12px;
            margin-right: 5px;
        }
        
        .info-box {
            background: #e8f4f8;
            border-left: 4px solid #3498db;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 4px;
        }
        
        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }
        
        .status-ativo {
            background: #d4edda;
            color: #155724;
        }
        
        .status-inativo {
            background: #f8d7da;
            color: #721c24;
        }
    
        /* Auth + topbar */
        .topbar{
            display:flex;
            justify-content:space-between;
            align-items:center;
            padding:12px 16px;
            background:#f4f6f8;
            border-bottom:1px solid #e3e7eb;
        }
        .user-email{ margin-left:10px; color:#555; font-size:0.9rem; }
        .auth-container{
            min-height:100vh;
            display:flex;
            align-items:center;
            justify-content:center;
            padding:24px;
            background:#f4f6f8;
        }
        .auth-card{
            width:100%;
            max-width:420px;
            background:#fff;
            border:1px solid #e3e7eb;
            border-radius:12px;
            padding:18px;
            box-shadow:0 6px 16px rgba(0,0,0,0.06);
        }
        .auth-card h2{ margin:0 0 8px; }
        .auth-hint{ margin:0 0 14px; color:#555; font-size:0.95rem; }
        .auth-card label{ display:block; margin-top:10px; font-weight:600; }
        .auth-card input{
            width:100%;
            padding:10px;
            margin-top:6px;
            border:1px solid #cfd6dd;
            border-radius:8px;
        }
        .auth-actions{ display:flex; gap:10px; margin-top:14px; }
        .auth-msg{ margin-top:12px; color:#b00020; font-size:0.92rem; }
        .btn{
            padding:10px 12px;
            border-radius:8px;
            border:1px solid #cfd6dd;
            background:#fff;
            cursor:pointer;
        }
        .btn.primary{
            background:#2d6cdf;
            border-color:#2d6cdf;
            color:#fff;
        }

</style>
</head>
<body>
    <div id="authContainer" class="auth-container">
        <div class="auth-card">
            <h2>Login</h2>
            <p class="auth-hint">Acesse seus dados de qualquer dispositivo usando sua conta.</p>
            <form id="loginForm">
                <label>Email</label>
                <input type="email" id="authEmail" required placeholder="seuemail@dominio.com" />
                <label>Senha</label>
                <input type="password" id="authPassword" required placeholder="Sua senha" />
                <div class="auth-actions">
                    <button type="submit" class="btn primary">Entrar</button>
                    <button type="button" id="btnSignup" class="btn">Criar conta</button>
                </div>
                <div id="authMsg" class="auth-msg"></div>
            </form>
        </div>
    </div>

    <div id="appContainer" style="display:none;">
        <div class="topbar">
            <div class="topbar-left">
                <strong>Controle Financeiro</strong>
                <span id="userEmail" class="user-email"></span>
            </div>
            <div class="topbar-right">
                <button class="btn" onclick="logout()">Sair</button>
            </div>
        </div>

        <div class="container">
        <div class="tabs">
            <button class="tab active" onclick="openTab('visaoGeral')">Vis√£o Geral</button>
            <button class="tab" onclick="openTab('entradas')">Entradas</button>
            <button class="tab" onclick="openTab('saidas')">Sa√≠das</button>
            <button class="tab" onclick="openTab('centrosCusto')">Centros de Custo</button>
            <button class="tab" onclick="openTab('categorias')">Categorias</button>
            <button class="tab" onclick="openTab('relatorios')">Relat√≥rios</button>
            <button class="tab" onclick="openTab('comoUsar')">Como Usar</button>
        </div>

        <!-- ABA 1: Vis√£o Geral -->
        <div id="visaoGeral" class="tab-content active">
            <h2>üìä Vis√£o Geral Financeira</h2>
            
            <div class="cards">
                <div class="card">
                    <div class="card-title">Saldo Inicial</div>
                    <div class="card-value">R$ <span id="saldoInicial">0,00</span></div>
                </div>
                <div class="card positive">
                    <div class="card-title">Total Entradas</div>
                    <div class="card-value">R$ <span id="totalEntradas">0,00</span></div>
                </div>
                <div class="card negative">
                    <div class="card-title">Total Sa√≠das</div>
                    <div class="card-value">R$ <span id="totalSaidas">0,00</span></div>
                </div>
                <div class="card" id="resultadoCard">
                    <div class="card-title">Resultado do Per√≠odo</div>
                    <div class="card-value">R$ <span id="resultado">0,00</span></div>
                </div>
            </div>

            <div class="form-group" style="max-width: 300px;">
                <label>Definir Saldo Inicial:</label>
                <input type="number" id="inputSaldoInicial" step="0.01" placeholder="0.00">
                <button class="btn" style="margin-top: 10px;" onclick="setSaldoInicial()">Atualizar Saldo</button>
            </div>

            <h3 style="margin-top: 30px; color: #2c3e50;">Por Tipo</h3>
            <div class="cards">
                <div class="card positive">
                    <div class="card-title">Familiar</div>
                    <div class="card-value">R$ <span id="resultadoFamiliar">0,00</span></div>
                </div>
                <div class="card positive">
                    <div class="card-title">Empresarial</div>
                    <div class="card-value">R$ <span id="resultadoEmpresarial">0,00</span></div>
                </div>
            </div>

            <div class="chart-container">
                <h3 style="color: #2c3e50; margin-bottom: 15px;">Resumo por Centro de Custo</h3>
                <div id="chartCentrosCusto"></div>
            </div>
        </div>

        <!-- ABA 2: Entradas -->
        <div id="entradas" class="tab-content">
            <h2>üí∞ Registro de Entradas</h2>
            
            <form id="formEntrada" onsubmit="addEntrada(event)">
                <div class="form-row">
                    <div class="form-group">
                        <label>Data *</label>
                        <input type="date" id="entradaData" required>
                    </div>
                    <div class="form-group">
                        <label>Descri√ß√£o *</label>
                        <input type="text" id="entradaDescricao" required>
                    </div>
                    <div class="form-group">
                        <label>Tipo *</label>
                        <select id="entradaTipo" required onchange="updateCentrosCustoEntrada()">
                            <option value="">Selecione...</option>
                            <option value="Familiar">Familiar</option>
                            <option value="Empresarial">Empresarial</option>
                            <option value="Pessoal">Pessoal</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Centro de Custo *</label>
                        <select id="entradaCentroCusto" required>
                            <option value="">Selecione o tipo primeiro</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Categoria *</label>
                        <select id="entradaCategoria" required>
                            <option value="">Selecione...</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Forma de Recebimento *</label>
                        <select id="entradaForma" required>
                            <option value="">Selecione...</option>
                            <option value="PIX">PIX</option>
                            <option value="Transfer√™ncia">Transfer√™ncia</option>
                            <option value="Dinheiro">Dinheiro</option>
                            <option value="Boleto">Boleto</option>
                            <option value="Cheque">Cheque</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Valor (R$) *</label>
                        <input type="number" id="entradaValor" step="0.01" required>
                    </div>
                </div>
                <div class="form-group">
                    <label>Observa√ß√µes</label>
                    <textarea id="entradaObs"></textarea>
                </div>
                <button type="submit" class="btn btn-success">Adicionar Entrada</button>
            </form>

            <div class="filters">
                <div class="form-group">
                    <label>Filtrar por M√™s</label>
                    <input type="month" id="filtroMesEntrada" onchange="renderEntradas()">
                </div>
                <div class="form-group">
                    <label>Filtrar por Tipo</label>
                    <select id="filtroTipoEntrada" onchange="renderEntradas()">
                        <option value="">Todos</option>
                        <option value="Familiar">Familiar</option>
                        <option value="Empresarial">Empresarial</option>
                        <option value="Pessoal">Pessoal</option>
                    </select>
                </div>
            </div>

            <table id="tabelaEntradas">
                <thead>
                    <tr>
                        <th>Data</th>
                        <th>Descri√ß√£o</th>
                        <th>Tipo</th>
                        <th>Centro de Custo</th>
                        <th>Categoria</th>
                        <th>Forma</th>
                        <th>Valor</th>
                        <th>A√ß√µes</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>

        <!-- ABA 3: Sa√≠das -->
        <div id="saidas" class="tab-content">
            <h2>üí∏ Registro de Sa√≠das</h2>
            
            <form id="formSaida" onsubmit="addSaida(event)">
                <div class="form-row">
                    <div class="form-group">
                        <label>Data *</label>
                        <input type="date" id="saidaData" required>
                    </div>
                    <div class="form-group">
                        <label>Descri√ß√£o *</label>
                        <input type="text" id="saidaDescricao" required>
                    </div>
                    <div class="form-group">
                        <label>Tipo *</label>
                        <select id="saidaTipo" required onchange="updateCentrosCustoSaida()">
                            <option value="">Selecione...</option>
                            <option value="Familiar">Familiar</option>
                            <option value="Empresarial">Empresarial</option>
                            <option value="Pessoal">Pessoal</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Centro de Custo *</label>
                        <select id="saidaCentroCusto" required>
                            <option value="">Selecione o tipo primeiro</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Categoria *</label>
                        <select id="saidaCategoria" required onchange="updateSubcategorias()">
                            <option value="">Selecione...</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Subcategoria</label>
                        <select id="saidaSubcategoria">
                            <option value="">Selecione a categoria primeiro</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Forma de Pagamento *</label>
                        <select id="saidaForma" required>
                            <option value="">Selecione...</option>
                            <option value="Cr√©dito">Cr√©dito</option>
                            <option value="D√©bito">D√©bito</option>
                            <option value="PIX">PIX</option>
                            <option value="Dinheiro">Dinheiro</option>
                            <option value="Boleto">Boleto</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Valor (R$) *</label>
                        <input type="number" id="saidaValor" step="0.01" required>
                    </div>
                </div>
                <div class="form-group">
                    <label>Observa√ß√µes</label>
                    <textarea id="saidaObs"></textarea>
                </div>
                <button type="submit" class="btn btn-danger">Adicionar Sa√≠da</button>
            </form>

            <div class="filters">
                <div class="form-group">
                    <label>Filtrar por M√™s</label>
                    <input type="month" id="filtroMesSaida" onchange="renderSaidas()">
                </div>
                <div class="form-group">
                    <label>Filtrar por Tipo</label>
                    <select id="filtroTipoSaida" onchange="renderSaidas()">
                        <option value="">Todos</option>
                        <option value="Familiar">Familiar</option>
                        <option value="Empresarial">Empresarial</option>
                        <option value="Pessoal">Pessoal</option>
                    </select>
                </div>
            </div>

            <table id="tabelaSaidas">
                <thead>
                    <tr>
                        <th>Data</th>
                        <th>Descri√ß√£o</th>
                        <th>Tipo</th>
                        <th>Centro de Custo</th>
                        <th>Categoria</th>
                        <th>Subcategoria</th>
                        <th>Forma</th>
                        <th>Valor</th>
                        <th>A√ß√µes</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>

        <!-- ABA 4: Centros de Custo -->
        <div id="centrosCusto" class="tab-content">
            <h2>üè¢ Gest√£o de Centros de Custo</h2>
            
            <form id="formCentroCusto" onsubmit="addCentroCusto(event)">
                <div class="form-row">
                    <div class="form-group">
                        <label>Nome do Centro de Custo *</label>
                        <input type="text" id="centroCustoNome" required>
                    </div>
                    <div class="form-group">
                        <label>Classifica√ß√£o *</label>
                        <select id="centroCustoTipo" required>
                            <option value="">Selecione...</option>
                            <option value="Familiar">Familiar</option>
                            <option value="Empresarial">Empresarial</option>
                            <option value="Pessoal">Pessoal</option>
                        </select>
                    </div>
                </div>
                <button type="submit" class="btn">Adicionar Centro de Custo</button>
            </form>

            <table id="tabelaCentrosCusto">
                <thead>
                    <tr>
                        <th>Nome</th>
                        <th>Classifica√ß√£o</th>
                        <th>Status</th>
                        <th>A√ß√µes</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>

        <!-- ABA 5: Categorias -->
        <div id="categorias" class="tab-content">
            <h2>üìã Gest√£o de Categorias</h2>
            
            <form id="formCategoria" onsubmit="addCategoria(event)">
                <div class="form-row">
                    <div class="form-group">
                        <label>Nome da Categoria *</label>
                        <input type="text" id="categoriaNome" required>
                    </div>
                    <div class="form-group">
                        <label>Tipo de Transa√ß√£o *</label>
                        <select id="categoriaTipoTransacao" required>
                            <option value="">Selecione...</option>
                            <option value="Entrada">Entrada</option>
                            <option value="Sa√≠da">Sa√≠da</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Associar com Tipo (Opcional)</label>
                        <select id="categoriaTipoAssociacao">
                            <option value="">Nenhum</option>
                            <option value="Familiar">Familiar</option>
                            <option value="Empresarial">Empresarial</option>
                            <option value="Pessoal">Pessoal</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label>Subcategorias (separadas por v√≠rgula)</label>
                    <input type="text" id="categoriaSubcategorias" placeholder="Ex: Subcategoria 1, Subcategoria 2">
                </div>
                <button type="submit" class="btn">Adicionar Categoria</button>
            </form>

            <table id="tabelaCategorias">
                <thead>
                    <tr>
                        <th>Categoria</th>
                        <th>Tipo</th>
                        <th>Associa√ß√£o</th>
                        <th>Subcategorias</th>
                        <th>A√ß√µes</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>

        <!-- ABA 6: Relat√≥rios -->
        <div id="relatorios" class="tab-content">
            <h2>üìà Relat√≥rios e An√°lises</h2>
            
            <div class="filters">
                <div class="form-group">
                    <label>Per√≠odo</label>
                    <input type="month" id="relatorioMes" onchange="renderRelatorios()">
                </div>
            </div>

            <h3 style="color: #2c3e50; margin-top: 20px;">Resumo Mensal</h3>
            <div class="cards">
                <div class="card positive">
                    <div class="card-title">Entradas</div>
                    <div class="card-value">R$ <span id="relEntradas">0,00</span></div>
                </div>
                <div class="card negative">
                    <div class="card-title">Sa√≠das</div>
                    <div class="card-value">R$ <span id="relSaidas">0,00</span></div>
                </div>
                <div class="card">
                    <div class="card-title">Resultado</div>
                    <div class="card-value">R$ <span id="relResultado">0,00</span></div>
                </div>
            </div>

            <h3 style="color: #2c3e50; margin-top: 30px;">Por Tipo</h3>
            <table id="tabelaRelTipo">
                <thead>
                    <tr>
                        <th>Tipo</th>
                        <th>Entradas</th>
                        <th>Sa√≠das</th>
                        <th>Resultado</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>

            <h3 style="color: #2c3e50; margin-top: 30px;">Por Centro de Custo</h3>
            <table id="tabelaRelCentro">
                <thead>
                    <tr>
                        <th>Centro de Custo</th>
                        <th>Entradas</th>
                        <th>Sa√≠das</th>
                        <th>Resultado</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>

            <h3 style="color: #2c3e50; margin-top: 30px;">Maiores Despesas</h3>
            <table id="tabelaMaioresDespesas">
                <thead>
                    <tr>
                        <th>Posi√ß√£o</th>
                        <th>Data</th>
                        <th>Descri√ß√£o</th>
                        <th>Categoria</th>
                        <th>Valor</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>

        <!-- ABA 7: Como Usar -->
        <div id="comoUsar" class="tab-content">
            <h2>üìñ Como Usar a Planilha</h2>
            
            <div class="info-box">
                <h3 style="margin-bottom: 10px;">Bem-vindo ao Controle Financeiro Unificado!</h3>
                <p>Esta ferramenta permite gerenciar suas finan√ßas familiares e empresariais de forma integrada.</p>
            </div>

            <h3 style="color: #2c3e50; margin-top: 20px;">1Ô∏è‚É£ Configura√ß√£o Inicial</h3>
            <p style="margin: 10px 0;"><strong>a) Centros de Custo:</strong> V√° at√© a aba "Centros de Custo" e cadastre seus centros (ex: Casa, Filhos, Administrativo, Operacional).</p>
            <p style="margin: 10px 0;"><strong>b) Categorias:</strong> Na aba "Categorias", adicione as categorias de entradas e sa√≠das relevantes para voc√™.</p>
            <p style="margin: 10px 0;"><strong>c) Saldo Inicial:</strong> Na aba "Vis√£o Geral", defina o saldo inicial do per√≠odo.</p>

            <h3 style="color: #2c3e50; margin-top: 20px;">2Ô∏è‚É£ Registro Di√°rio</h3>
            <p style="margin: 10px 0;"><strong>Entradas:</strong> Registre todos os recebimentos na aba "Entradas" com data, descri√ß√£o, tipo, centro de custo, categoria e forma de recebimento.</p>
            <p style="margin: 10px 0;"><strong>Sa√≠das:</strong> Registre todas as despesas na aba "Sa√≠das" com as mesmas informa√ß√µes, incluindo subcategoria e forma de pagamento.</p>

            <h3 style="color: #2c3e50; margin-top: 20px;">3Ô∏è‚É£ Acompanhamento</h3>
            <p style="margin: 10px 0;"><strong>Vis√£o Geral:</strong> Acompanhe seus totais, resultado e separa√ß√£o por tipo em tempo real.</p>
            <p style="margin: 10px 0;"><strong>Relat√≥rios:</strong> Use a aba "Relat√≥rios" para an√°lises mensais, por tipo e por centro de custo.</p>

            <h3 style="color: #2c3e50; margin-top: 20px;">4Ô∏è‚É£ Filtros</h3>
            <p style="margin: 10px 0;">Use os filtros dispon√≠veis nas abas de Entradas e Sa√≠das para visualizar per√≠odos espec√≠ficos ou tipos determinados.</p>

            <h3 style="color: #2c3e50; margin-top: 20px;">5Ô∏è‚É£ Gest√£o de Centros e Categorias</h3>
            <p style="margin: 10px 0;">Voc√™ pode ativar/desativar centros de custo e excluir categorias conforme necess√°rio.</p>

            <div class="info-box" style="margin-top: 30px; background: #fff3cd; border-left-color: #ffc107;">
                <h4 style="margin-bottom: 10px;">üí° Dicas Importantes:</h4>
                <ul style="margin-left: 20px;">
                    <li>Mantenha registros di√°rios para melhor controle</li>
                    <li>Use observa√ß√µes para detalhes importantes</li>
                    <li>Revise os relat√≥rios mensalmente</li>
                    <li>Separe bem as finan√ßas familiar e empresarial</li>
                    <li>Seus dados s√£o salvos automaticamente no navegador</li>
                </ul>
            </div>
        </div>
    </div>

    
        <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
        <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

        <script>
        // Dados em mem√≥ria
        let dados = {
            saldoInicial: 0,
            entradas: [],
            saidas: [],
            centrosCusto: [
                {nome: 'Casa', tipo: 'Familiar', ativo: true},
                {nome: 'Filhos', tipo: 'Familiar', ativo: true},
                {nome: 'Ve√≠culo', tipo: 'Familiar', ativo: true},
                {nome: 'Administrativo', tipo: 'Empresarial', ativo: true},
                {nome: 'Operacional', tipo: 'Empresarial', ativo: true},
                {nome: 'Comercial', tipo: 'Empresarial', ativo: true},
                {nome: 'Sa√∫de', tipo: 'Pessoal', ativo: true},
                {nome: 'Educa√ß√£o', tipo: 'Pessoal', ativo: true}
            ],
            categorias: [
                {nome: 'Sal√°rio', tipo: 'Entrada', associacao: 'Familiar', subcategorias: []},
                {nome: 'Vendas', tipo: 'Entrada', associacao: 'Empresarial', subcategorias: []},
                {nome: 'Alimenta√ß√£o', tipo: 'Sa√≠da', associacao: 'Familiar', subcategorias: ['Supermercado', 'Restaurante']},
                {nome: 'Transporte', tipo: 'Sa√≠da', associacao: '', subcategorias: ['Combust√≠vel', 'Manuten√ß√£o']},
                {nome: 'Fornecedores', tipo: 'Sa√≠da', associacao: 'Empresarial', subcategorias: []}
            ]
        };

        // Carregar dados salvos
        async function loadData() {
            // Primeiro tenta carregar local (para abrir r√°pido e para caso offline)
            try {
                const savedLocal = localStorage.getItem('controleFin');
                if (savedLocal) {
                    dados = JSON.parse(savedLocal);
                }
            } catch (e) {}

            // Se n√£o estiver logado, segue com o que tiver
            if (!window.__session || !window.supabaseClient) {
                renderAll();
                return;
            }

            // Carrega do Supabase (fonte principal)
            const userId = window.__session.user.id;
            const { data, error } = await window.supabaseClient
                .from('app_state')
                .select('state')
                .eq('user_id', userId)
                .maybeSingle();

            if (error) {
                console.error('Erro ao carregar do Supabase:', error.message);
                renderAll();
                return;
            }

            if (data && data.state) {
                dados = data.state;
                try { localStorage.setItem('controleFin', JSON.stringify(dados)); } catch (e) {}
            } else {
                // Primeira vez do usu√°rio: cria estado inicial na nuvem
                const { error: upErr } = await window.supabaseClient.from('app_state').upsert({
                    user_id: userId,
                    state: dados,
                    updated_at: new Date().toISOString()
                }, { onConflict: 'user_id' });
                if (upErr) console.error('Erro ao criar estado inicial:', upErr.message);
            }

            renderAll();
        }
// Definir data de hoje nos campos
            const hoje = new Date().toISOString().split('T')[0];
            document.getElementById('entradaData').value = hoje;
            document.getElementById('saidaData').value = hoje;
            
            renderAll();
        }

        // Salvar dados
        async function saveData() {
            // Se estiver logado, salva no Supabase. Se n√£o, salva local para n√£o perder.
            try {
                localStorage.setItem('controleFin', JSON.stringify(dados));
            } catch (e) {}

            if (!window.__session || !window.supabaseClient) return;

            const payload = { user_id: window.__session.user.id, state: dados, updated_at: new Date().toISOString() };
            const { error } = await window.supabaseClient.from('app_state').upsert(payload, { onConflict: 'user_id' });
            if (error) console.error('Erro ao salvar no Supabase:', error.message);
        }
// Abrir abas
        function openTab(tabName) {
            const tabs = document.querySelectorAll('.tab');
            const contents = document.querySelectorAll('.tab-content');
            
            tabs.forEach(t => t.classList.remove('active'));
            contents.forEach(c => c.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
        }

        // Formatar moeda
        function formatMoney(val) {
            return parseFloat(val || 0).toFixed(2).replace('.', ',');
        }

        // Saldo Inicial
        function setSaldoInicial() {
            const val = parseFloat(document.getElementById('inputSaldoInicial').value) || 0;
            dados.saldoInicial = val;
            saveData();
            updateVisaoGeral();
        }

        // Adicionar Entrada
        function addEntrada(e) {
            e.preventDefault();
            const entrada = {
                id: Date.now(),
                data: document.getElementById('entradaData').value,
                descricao: document.getElementById('entradaDescricao').value,
                tipo: document.getElementById('entradaTipo').value,
                centroCusto: document.getElementById('entradaCentroCusto').value,
                categoria: document.getElementById('entradaCategoria').value,
                forma: document.getElementById('entradaForma').value,
                valor: parseFloat(document.getElementById('entradaValor').value),
                obs: document.getElementById('entradaObs').value
            };
            
            dados.entradas.push(entrada);
            saveData();
            e.target.reset();
            document.getElementById('entradaData').value = new Date().toISOString().split('T')[0];
            renderEntradas();
            updateVisaoGeral();
        }

        // Adicionar Sa√≠da
        function addSaida(e) {
            e.preventDefault();
            const saida = {
                id: Date.now(),
                data: document.getElementById('saidaData').value,
                descricao: document.getElementById('saidaDescricao').value,
                tipo: document.getElementById('saidaTipo').value,
                centroCusto: document.getElementById('saidaCentroCusto').value,
                categoria: document.getElementById('saidaCategoria').value,
                subcategoria: document.getElementById('saidaSubcategoria').value,
                forma: document.getElementById('saidaForma').value,
                valor: parseFloat(document.getElementById('saidaValor').value),
                obs: document.getElementById('saidaObs').value
            };
            
            dados.saidas.push(saida);
            saveData();
            e.target.reset();
            document.getElementById('saidaData').value = new Date().toISOString().split('T')[0];
            renderSaidas();
            updateVisaoGeral();
        }

        // Adicionar Centro de Custo
        function addCentroCusto(e) {
            e.preventDefault();
            const centro = {
                nome: document.getElementById('centroCustoNome').value,
                tipo: document.getElementById('centroCustoTipo').value,
                ativo: true
            };
            
            dados.centrosCusto.push(centro);
            saveData();
            e.target.reset();
            renderCentrosCusto();
            updateCentrosCustoSelects();
        }

        // Adicionar Categoria
        function addCategoria(e) {
            e.preventDefault();
            const subs = document.getElementById('categoriaSubcategorias').value;
            const categoria = {
                nome: document.getElementById('categoriaNome').value,
                tipo: document.getElementById('categoriaTipoTransacao').value,
                associacao: document.getElementById('categoriaTipoAssociacao').value,
                subcategorias: subs ? subs.split(',').map(s => s.trim()) : []
            };
            
            dados.categorias.push(categoria);
            saveData();
            e.target.reset();
            renderCategorias();
            updateCategoriasSelects();
        }

        // Deletar
        function deleteEntrada(id) {
            if (confirm('Deseja realmente excluir esta entrada?')) {
                dados.entradas = dados.entradas.filter(e => e.id !== id);
                saveData();
                renderEntradas();
                updateVisaoGeral();
            }
        }

        function deleteSaida(id) {
            if (confirm('Deseja realmente excluir esta sa√≠da?')) {
                dados.saidas = dados.saidas.filter(s => s.id !== id);
                saveData();
                renderSaidas();
                updateVisaoGeral();
            }
        }

        function deleteCategoria(nome) {
            if (confirm('Deseja realmente excluir esta categoria?')) {
                dados.categorias = dados.categorias.filter(c => c.nome !== nome);
                saveData();
                renderCategorias();
                updateCategoriasSelects();
            }
        }

        function toggleCentroCusto(nome) {
            const centro = dados.centrosCusto.find(c => c.nome === nome);
            if (centro) {
                centro.ativo = !centro.ativo;
                saveData();
                renderCentrosCusto();
                updateCentrosCustoSelects();
            }
        }

        // Atualizar selects
        function updateCentrosCustoEntrada() {
            const tipo = document.getElementById('entradaTipo').value;
            const select = document.getElementById('entradaCentroCusto');
            select.innerHTML = '<option value="">Selecione...</option>';
            
            dados.centrosCusto
                .filter(c => c.tipo === tipo && c.ativo)
                .forEach(c => {
                    const opt = document.createElement('option');
                    opt.value = c.nome;
                    opt.textContent = c.nome;
                    select.appendChild(opt);
                });
        }

        function updateCentrosCustoSaida() {
            const tipo = document.getElementById('saidaTipo').value;
            const select = document.getElementById('saidaCentroCusto');
            select.innerHTML = '<option value="">Selecione...</option>';
            
            dados.centrosCusto
                .filter(c => c.tipo === tipo && c.ativo)
                .forEach(c => {
                    const opt = document.createElement('option');
                    opt.value = c.nome;
                    opt.textContent = c.nome;
                    select.appendChild(opt);
                });
        }

        function updateCentrosCustoSelects() {
            updateCentrosCustoEntrada();
            updateCentrosCustoSaida();
        }

        function updateCategoriasSelects() {
            const selectEntrada = document.getElementById('entradaCategoria');
            const selectSaida = document.getElementById('saidaCategoria');
            
            selectEntrada.innerHTML = '<option value="">Selecione...</option>';
            selectSaida.innerHTML = '<option value="">Selecione...</option>';
            
            dados.categorias.forEach(c => {
                const opt = document.createElement('option');
                opt.value = c.nome;
                opt.textContent = c.nome;
                
                if (c.tipo === 'Entrada') selectEntrada.appendChild(opt.cloneNode(true));
                if (c.tipo === 'Sa√≠da') selectSaida.appendChild(opt);
            });
        }

        function updateSubcategorias() {
            const catNome = document.getElementById('saidaCategoria').value;
            const select = document.getElementById('saidaSubcategoria');
            select.innerHTML = '<option value="">Nenhuma</option>';
            
            const cat = dados.categorias.find(c => c.nome === catNome);
            if (cat && cat.subcategorias) {
                cat.subcategorias.forEach(sub => {
                    const opt = document.createElement('option');
                    opt.value = sub;
                    opt.textContent = sub;
                    select.appendChild(opt);
                });
            }
        }

        // Render
        function renderEntradas() {
            const tbody = document.querySelector('#tabelaEntradas tbody');
            const filtroMes = document.getElementById('filtroMesEntrada').value;
            const filtroTipo = document.getElementById('filtroTipoEntrada').value;
            
            let filtered = dados.entradas;
            if (filtroMes) filtered = filtered.filter(e => e.data.startsWith(filtroMes));
            if (filtroTipo) filtered = filtered.filter(e => e.tipo === filtroTipo);
            
            tbody.innerHTML = filtered.map(e => `
                <tr>
                    <td>${new Date(e.data).toLocaleDateString('pt-BR')}</td>
                    <td>${e.descricao}</td>
                    <td>${e.tipo}</td>
                    <td>${e.centroCusto}</td>
                    <td>${e.categoria}</td>
                    <td>${e.forma}</td>
                    <td>R$ ${formatMoney(e.valor)}</td>
                    <td><button class="btn btn-danger action-btn" onclick="deleteEntrada(${e.id})">Excluir</button></td>
                </tr>
            `).join('');
        }

        function renderSaidas() {
            const tbody = document.querySelector('#tabelaSaidas tbody');
            const filtroMes = document.getElementById('filtroMesSaida').value;
            const filtroTipo = document.getElementById('filtroTipoSaida').value;
            
            let filtered = dados.saidas;
            if (filtroMes) filtered = filtered.filter(s => s.data.startsWith(filtroMes));
            if (filtroTipo) filtered = filtered.filter(s => s.tipo === filtroTipo);
            
            tbody.innerHTML = filtered.map(s => `
                <tr>
                    <td>${new Date(s.data).toLocaleDateString('pt-BR')}</td>
                    <td>${s.descricao}</td>
                    <td>${s.tipo}</td>
                    <td>${s.centroCusto}</td>
                    <td>${s.categoria}</td>
                    <td>${s.subcategoria || '-'}</td>
                    <td>${s.forma}</td>
                    <td>R$ ${formatMoney(s.valor)}</td>
                    <td><button class="btn btn-danger action-btn" onclick="deleteSaida(${s.id})">Excluir</button></td>
                </tr>
            `).join('');
        }

        function renderCentrosCusto() {
            const tbody = document.querySelector('#tabelaCentrosCusto tbody');
            tbody.innerHTML = dados.centrosCusto.map(c => `
                <tr>
                    <td>${c.nome}</td>
                    <td>${c.tipo}</td>
                    <td><span class="status-badge status-${c.ativo ? 'ativo' : 'inativo'}">${c.ativo ? 'Ativo' : 'Inativo'}</span></td>
                    <td><button class="btn action-btn" onclick="toggleCentroCusto('${c.nome}')">${c.ativo ? 'Desativar' : 'Ativar'}</button></td>
                </tr>
            `).join('');
        }

        function renderCategorias() {
            const tbody = document.querySelector('#tabelaCategorias tbody');
            tbody.innerHTML = dados.categorias.map(c => `
                <tr>
                    <td>${c.nome}</td>
                    <td>${c.tipo}</td>
                    <td>${c.associacao || '-'}</td>
                    <td>${c.subcategorias.join(', ') || '-'}</td>
                    <td><button class="btn btn-danger action-btn" onclick="deleteCategoria('${c.nome}')">Excluir</button></td>
                </tr>
            `).join('');
        }

        function updateVisaoGeral() {
            const totalEnt = dados.entradas.reduce((s, e) => s + e.valor, 0);
            const totalSai = dados.saidas.reduce((s, e) => s + e.valor, 0);
            const resultado = dados.saldoInicial + totalEnt - totalSai;
            
            document.getElementById('saldoInicial').textContent = formatMoney(dados.saldoInicial);
            document.getElementById('totalEntradas').textContent = formatMoney(totalEnt);
            document.getElementById('totalSaidas').textContent = formatMoney(totalSai);
            document.getElementById('resultado').textContent = formatMoney(resultado);
            
            const card = document.getElementById('resultadoCard');
            card.className = 'card ' + (resultado >= 0 ? 'positive' : 'negative');
            
            // Por tipo
            const entFam = dados.entradas.filter(e => e.tipo === 'Familiar').reduce((s, e) => s + e.valor, 0);
            const saiFam = dados.saidas.filter(e => e.tipo === 'Familiar').reduce((s, e) => s + e.valor, 0);
            const entEmp = dados.entradas.filter(e => e.tipo === 'Empresarial').reduce((s, e) => s + e.valor, 0);
            const saiEmp = dados.saidas.filter(e => e.tipo === 'Empresarial').reduce((s, e) => s + e.valor, 0);
            const entPes = dados.entradas.filter(e => e.tipo === 'Pessoal').reduce((s, e) => s + e.valor, 0);
            const saiPes = dados.saidas.filter(e => e.tipo === 'Pessoal').reduce((s, e) => s + e.valor, 0);
            
            document.getElementById('resultadoFamiliar').textContent = formatMoney(entFam - saiFam);
            document.getElementById('resultadoEmpresarial').textContent = formatMoney(entEmp - saiEmp);
            document.getElementById('resultadoPessoal').textContent = formatMoney(entPes - saiPes);
            
            // Chart centros de custo
            renderChartCentros();
        }

        function renderChartCentros() {
            const div = document.getElementById('chartCentrosCusto');
            const centros = {};
            
            dados.centrosCusto.forEach(c => {
                const ent = dados.entradas.filter(e => e.centroCusto === c.nome).reduce((s, e) => s + e.valor, 0);
                const sai = dados.saidas.filter(e => e.centroCusto === c.nome).reduce((s, e) => s + e.valor, 0);
                centros[c.nome] = ent - sai;
            });
            
            div.innerHTML = Object.entries(centros)
                .sort((a, b) => b[1] - a[1])
                .map(([nome, val]) => `
                    <div style="margin: 10px 0; padding: 10px; background: white; border-radius: 4px;">
                        <strong>${nome}:</strong> R$ ${formatMoney(val)}
                        <div style="background: ${val >= 0 ? '#27ae60' : '#e74c3c'}; height: 8px; border-radius: 4px; width: ${Math.min(Math.abs(val) / 100, 100)}%; margin-top: 5px;"></div>
                    </div>
                `).join('');
        }

        function renderRelatorios() {
            const mes = document.getElementById('relatorioMes').value;
            let entradas = dados.entradas;
            let saidas = dados.saidas;
            
            if (mes) {
                entradas = entradas.filter(e => e.data.startsWith(mes));
                saidas = saidas.filter(s => s.data.startsWith(mes));
            }
            
            const totalEnt = entradas.reduce((s, e) => s + e.valor, 0);
            const totalSai = saidas.reduce((s, e) => s + e.valor, 0);
            
            document.getElementById('relEntradas').textContent = formatMoney(totalEnt);
            document.getElementById('relSaidas').textContent = formatMoney(totalSai);
            document.getElementById('relResultado').textContent = formatMoney(totalEnt - totalSai);
            
            // Por tipo
            const tbodyTipo = document.querySelector('#tabelaRelTipo tbody');
            const tipos = ['Familiar', 'Empresarial', 'Pessoal'];
            tbodyTipo.innerHTML = tipos.map(t => {
                const ent = entradas.filter(e => e.tipo === t).reduce((s, e) => s + e.valor, 0);
                const sai = saidas.filter(s => s.tipo === t).reduce((s, e) => s + e.valor, 0);
                return `<tr><td>${t}</td><td>R$ ${formatMoney(ent)}</td><td>R$ ${formatMoney(sai)}</td><td>R$ ${formatMoney(ent - sai)}</td></tr>`;
            }).join('');
            
            // Por centro
            const tbodyCentro = document.querySelector('#tabelaRelCentro tbody');
            tbodyCentro.innerHTML = dados.centrosCusto.map(c => {
                const ent = entradas.filter(e => e.centroCusto === c.nome).reduce((s, e) => s + e.valor, 0);
                const sai = saidas.filter(s => s.centroCusto === c.nome).reduce((s, e) => s + e.valor, 0);
                return `<tr><td>${c.nome}</td><td>R$ ${formatMoney(ent)}</td><td>R$ ${formatMoney(sai)}</td><td>R$ ${formatMoney(ent - sai)}</td></tr>`;
            }).join('');
            
            // Maiores despesas
            const tbodyDespesas = document.querySelector('#tabelaMaioresDespesas tbody');
            const maiores = [...saidas].sort((a, b) => b.valor - a.valor).slice(0, 10);
            tbodyDespesas.innerHTML = maiores.map((s, i) => `
                <tr>
                    <td>${i + 1}¬∫</td>
                    <td>${new Date(s.data).toLocaleDateString('pt-BR')}</td>
                    <td>${s.descricao}</td>
                    <td>${s.categoria}</td>
                    <td>R$ ${formatMoney(s.valor)}</td>
                </tr>
            `).join('');
        }

        function renderAll() {
            renderEntradas();
            renderSaidas();
            renderCentrosCusto();
            renderCategorias();
            updateVisaoGeral();
            renderRelatorios();
            updateCentrosCustoSelects();
            updateCategoriasSelects();
        }

        // ===== Supabase Auth + Sync =====
        // 1) Crie um projeto no Supabase e pegue URL e ANON KEY (Settings -> API)
        // 2) Preencha os valores abaixo.
        const SUPABASE_URL = "https://qnuvhctcovjgsohszlhx.supabase.co";
        const SUPABASE_ANON_KEY = "Csb_publishable_BtAqdyCzwcgwnNVYP4KjTQ_fMQisBIu";

        window.supabaseClient = null;
        window.__session = null;

        function showAuth(msg) {
            document.getElementById('appContainer').style.display = 'none';
            document.getElementById('authContainer').style.display = 'flex';
            document.getElementById('authMsg').textContent = msg || '';
        }

        function showApp(email) {
            document.getElementById('authContainer').style.display = 'none';
            document.getElementById('appContainer').style.display = 'block';
            document.getElementById('userEmail').textContent = email ? `(${email})` : '';
        }

        async function initSupabase() {
            if (!SUPABASE_URL.startsWith('http') || SUPABASE_ANON_KEY.includes('COLE_')) {
                showAuth('Configure SUPABASE_URL e SUPABASE_ANON_KEY no final do arquivo.');
                return;
            }

            window.supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

            const { data: { session } } = await window.supabaseClient.auth.getSession();
            window.__session = session || null;

            window.supabaseClient.auth.onAuthStateChange(async (event, session2) => {
                window.__session = session2 || null;
                if (window.__session) {
                    showApp(window.__session.user.email);
                    await loadData();
                } else {
                    showAuth('');
                }
            });

            if (window.__session) {
                showApp(window.__session.user.email);
                await loadData();
            } else {
                showAuth('');
            }
        }

        async function login(email, password) {
            const { error } = await window.supabaseClient.auth.signInWithPassword({ email, password });
            if (error) throw error;
        }

        async function signup(email, password) {
            const { error } = await window.supabaseClient.auth.signUp({ email, password });
            if (error) throw error;
            // Dependendo da config do Supabase, pode exigir confirma√ß√£o por email.
        }

        async function logout() {
            if (!window.supabaseClient) return;
            await window.supabaseClient.auth.signOut();
        }

        // ===== CSV Import/Export =====
        function downloadTemplate(kind) {
            // kind: 'entradas' | 'saidas'
            const headers = [
                'data', 'descricao', 'tipo', 'centroCusto', 'categoria', 'subcategoria', 'forma', 'valor', 'observacao'
            ];

            const sample = kind === 'entradas'
                ? ['2026-01-07', 'Sal√°rio', 'Familiar', 'Pessoal', 'Sal√°rio', '', 'PIX', '3500.00', '']
                : ['2026-01-07', 'Mercado', 'Familiar', 'Casa', 'Alimenta√ß√£o', 'Mercado', 'Cart√£o', '250.50', ''];

            const csv = [headers.join(';'), sample.join(';')].join('
');
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8' });
            const url = URL.createObjectURL(blob);

            const a = document.createElement('a');
            a.href = url;
            a.download = `template_${kind}.csv`;
            document.body.appendChild(a);
            a.click();
            a.remove();
            URL.revokeObjectURL(url);
        }

        function triggerImport(kind) {
            const input = document.getElementById('csvFileInput');
            input.value = '';
            input.dataset.kind = kind;
            input.click();
        }

        async function importCSV(file, kind) {
            return new Promise((resolve, reject) => {
                Papa.parse(file, {
                    header: true,
                    skipEmptyLines: true,
                    dynamicTyping: false,
                    complete: async (results) => {
                        try {
                            if (results.errors && results.errors.length) {
                                reject(new Error('CSV inv√°lido: ' + results.errors[0].message));
                                return;
                            }

                            const rows = results.data || [];
                            if (!rows.length) {
                                resolve({ inserted: 0 });
                                return;
                            }

                            let inserted = 0;
                            for (const r of rows) {
                                // Normaliza campos
                                const data = (r.data || '').trim();
                                const descricao = (r.descricao || '').trim();
                                const tipo = (r.tipo || '').trim(); // Familiar/Empresarial/Pessoal (se usar)
                                const centroCusto = (r.centroCusto || '').trim();
                                const categoria = (r.categoria || '').trim();
                                const subcategoria = (r.subcategoria || '').trim();
                                const forma = (r.forma || '').trim();
                                const observacao = (r.observacao || '').trim();

                                let valorStr = String(r.valor ?? '').trim();
                                // aceita "1.234,56" ou "1234.56"
                                valorStr = valorStr.replace(/\./g, '').replace(',', '.');
                                const valor = parseFloat(valorStr);

                                if (!data || !descricao || !tipo || !centroCusto || !categoria || !forma || !isFinite(valor)) {
                                    continue; // pula linha incompleta
                                }

                                const item = {
                                    id: Date.now() + Math.floor(Math.random() * 100000),
                                    data,
                                    descricao,
                                    tipo,
                                    centroCusto,
                                    categoria,
                                    subcategoria: kind === 'saidas' ? subcategoria : '',
                                    forma,
                                    valor,
                                    observacao
                                };

                                if (kind === 'entradas') dados.entradas.push(item);
                                else dados.saidas.push(item);

                                inserted++;
                            }

                            await saveData();
                            resolve({ inserted });
                        } catch (e) {
                            reject(e);
                        }
                    }
                });
            });
        }

        // ===== Inicializar =====
        document.addEventListener('DOMContentLoaded', () => {
            // Eventos de login
            const form = document.getElementById('loginForm');
            form.addEventListener('submit', async (e) => {
                e.preventDefault();
                const email = document.getElementById('authEmail').value.trim();
                const pass = document.getElementById('authPassword').value;
                document.getElementById('authMsg').textContent = '';
                try {
                    await login(email, pass);
                } catch (err) {
                    document.getElementById('authMsg').textContent = err.message || 'Falha ao entrar.';
                }
            });

            document.getElementById('btnSignup').addEventListener('click', async () => {
                const email = document.getElementById('authEmail').value.trim();
                const pass = document.getElementById('authPassword').value;
                document.getElementById('authMsg').textContent = '';
                try {
                    await signup(email, pass);
                    document.getElementById('authMsg').textContent =
                        'Conta criada. Se o Supabase exigir confirma√ß√£o por email, confirme e depois entre.';
                } catch (err) {
                    document.getElementById('authMsg').textContent = err.message || 'Falha ao criar conta.';
                }
            });

            // Import CSV
            const input = document.getElementById('csvFileInput');
            input.addEventListener('change', async () => {
                const file = input.files && input.files[0];
                if (!file) return;
                const kind = input.dataset.kind;
                const msg = document.getElementById('importMsg');
                msg.textContent = 'Importando...';
                try {
                    const res = await importCSV(file, kind);
                    msg.textContent = `Importa√ß√£o conclu√≠da. Linhas inseridas: ${res.inserted}`;
                    renderAll();
                } catch (e) {
                    msg.style.color = '#b00020';
                    msg.textContent = e.message || 'Falha ao importar.';
                } finally {
                    setTimeout(() => { msg.style.color = '#0a6'; }, 1200);
                }
            });

            // Inicia Supabase e depois carrega dados
            initSupabase();
        });
</script>
    
            <hr style="margin:24px 0;">
            <h3>Importar e Exportar (CSV)</h3>
            <p>Baixe o template, preencha, e importe. Serve para Entradas e Sa√≠das.</p>

            <div style="display:flex; flex-wrap:wrap; gap:10px; margin:12px 0;">
                <button class="btn" onclick="downloadTemplate('entradas')">Baixar template de Entradas</button>
                <button class="btn" onclick="downloadTemplate('saidas')">Baixar template de Sa√≠das</button>
                <button class="btn" onclick="triggerImport('entradas')">Importar CSV de Entradas</button>
                <button class="btn" onclick="triggerImport('saidas')">Importar CSV de Sa√≠das</button>
            </div>
            <input type="file" id="csvFileInput" accept=".csv,.txt" style="display:none;" />
            <div id="importMsg" style="margin-top:8px; color:#0a6; font-size:0.95rem;"></div>

</div>
</body>
</html>